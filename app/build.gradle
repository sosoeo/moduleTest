/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.9/userguide/building_java_projects.html
 */

plugins {
    id 'application'
    id 'org.javamodularity.moduleplugin' version '1.8.10' apply true
    id 'org.beryx.jlink' version '2.24.0'
}
repositories {    jcenter()  }

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.3.1'
    testImplementation 'org.junit.jupiter:junit-jupiter-params:5.3.1'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.3.1'

    implementation 'com.google.guava:guava:31.0.1-jre'
    implementation "com.formdev:flatlaf:1.6.5"
}

tasks.named('test') {
    useJUnitPlatform()
}

def myMainClass = "myPackage.App"
application {
    // Define the main class for the application.
    //Java Module System module name
    mainModule.set('moduleTest.app.main')
    //Your JavaFX application class
    mainClass.set("$myMainClass")

}
jar {
    manifest {
        attributes (
                'Main-Class':"$myMainClass",
                'Built-By'       : System.properties['user.name'],
                'Build-Timestamp': new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").format(new Date()),
                'Created-By'     : "Gradle ${gradle.gradleVersion}",
                'Build-Jdk'      : "${System.properties['java.version']} (${System.properties['java.vendor']} ${System.properties['java.vm.version']})",
                'Build-OS'       : "${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}",
        )
    }
}

tasks.withType(JavaCompile) { options.encoding = 'UTF-8' }

jlink {
    options = ['--strip-debug', '--compress', '2', '--no-header-files', '--no-man-pages']
    launcher{
        jvmArgs = ['-Dlog4j.configurationFile=./log4j2.xml']
    }

    jpackage {
        jpackageHome = 'C:/jdk-17.0.0-zulu'
        outputDir = 'my-packaging'
        imageName     = "flatlafJava9ModuleDemo"    //应用程序的名称
        appVersion    = "1.0.0"
        icon = file("$projectDir/src/main/resources/img/icon.ico")
        skipInstaller = false
        installerName = "my installer"              //安装文件的名称
        installerType = 'msi'
        installerOptions = ['--win-dir-chooser','--win-menu-group','--win-shortcut-prompt']
    }
}
